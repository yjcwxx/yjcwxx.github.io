---
import siteConfig from '../../site.config.mjs';

const owner = siteConfig.owner;
const base = import.meta.env.BASE_URL;
const baseClean = base === '/' ? '' : base;
---

<div class="absolute left-0 right-0 z-0">
	<div class="text-center mb-12 relative z-10 mt-16 md:mt-20">
		<!-- 头像和爱心区域 -->
		<div class="flex items-center justify-center gap-4 md:gap-6 mb-8">
			<!-- 左侧头像 -->
			<div class="avatar-container">
				<img 
					src="/images/avatar1.jpg" 
					alt="YJC" 
					class="w-16 h-16 md:w-20 md:h-20 rounded-full object-cover border-4 border-white shadow-lg"
					onerror="this.src='/images/profile.webp'"
				/>
			</div>
			
			<!-- 跳动的爱心 -->
			<div class="heart-container">
				<span class="heart-beat text-3xl md:text-4xl">❤️</span>
			</div>
			
			<!-- 右侧头像 -->
			<div class="avatar-container">
				<img 
					src="/images/avatar2.jpg" 
					alt="WXX" 
					class="w-16 h-16 md:w-20 md:h-20 rounded-full object-cover border-4 border-white shadow-lg"
					onerror="this.src='/images/profile.webp'"
				/>
			</div>
		</div>
		
		<h1 class="text-3xl md:text-4xl lg:text-5xl font-bold leading-tight">
			欢迎来到YJC和WXX的小窝~
		</h1>
		<p id="time-together" class="mt-4 text-base md:text-lg text-gray-700">
			我们已经在一起...
		</p>
		<a
			href={`${baseClean}/collections`}
			class="mt-8 inline-block px-6 py-3 border-2 border-black rounded-md
                      hover:bg-black hover:text-white transition-all duration-300
                      text-sm md:text-base font-medium
                      transform hover:scale-105 active:scale-95"
		>
			查看相册
		</a>
	</div>
</div>

<script>
	// 计算时间差的函数
	function calculateTimeDiff(startDate: string) {
		const start = new Date(startDate);
		const now = new Date();
		const diff = now.getTime() - start.getTime();
		
		const days = Math.floor(diff / (1000 * 60 * 60 * 24));
		const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
		const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
		const seconds = Math.floor((diff % (1000 * 60)) / 1000);
		
		return { days, hours, minutes, seconds };
	}
	
	// 更新显示的函数
	function updateTimeTogether(startDate: string) {
		const element = document.getElementById('time-together');
		if (!element) return;
		
		const { days, hours, minutes, seconds } = calculateTimeDiff(startDate);
		element.textContent = `我们已经在一起 ${days} 天 ${hours} 小时 ${minutes} 分 ${seconds} 秒啦`;
	}
	
	// 获取开始时间并开始计时
	async function initTimer() {
		try {
			const response = await fetch('/api/time-together');
			const data = await response.json();
			const startDate = data.startDate;
			
			// 立即更新一次
			updateTimeTogether(startDate);
			
			// 每秒更新一次
			setInterval(() => updateTimeTogether(startDate), 1000);
		} catch (error) {
			console.error('Failed to fetch start date:', error);
		}
	}
	
	// 页面加载后开始计时
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initTimer);
	} else {
		initTimer();
	}
</script>
